<!DOCTYPE html><html lang="en-GB"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Dani Lee Arts - Workshop Booking Form</title><meta name="description" content="Book a workshop with Dani Lee Arts"><link rel="apple-touch-icon" sizes="180x180" href="img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="img/favicons/favicon-16x16.png"><link rel="manifest" href="img/favicons/site.webmanifest"><link href="css/style.css?t=1727781991939" rel="stylesheet"><script async defer="defer" src="https://apis.google.com/js/api.js"></script><script src="https://accounts.google.com/gsi/client" async defer="defer"></script><style>/* General form styles */
    .booking-form {
      display: flex;
      flex-direction: column;
      max-width: 500px;
      margin: 40px auto;
      padding: 20px;
      background-color: transparent;
      border-radius: 10px;
    }

    .booking-form label {
      font-size: 18px;
      margin-bottom: 5px;
    }

    .booking-form input, .booking-form select {
      padding: 10px;
      font-size: 16px;
      margin-bottom: 20px;
      border: 2px solid #ccc;
      border-radius: 5px;
      width: 100%;
    }

    .booking-form button {
      padding: 15px;
      font-size: 20px;
      background-color: #7A2944;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .booking-form button:hover {
      background-color: #5b2134;
    }

    .booking-form {
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
    }

    #other_input_container {
      margin-top: 10px;
      padding: 8px;
      font-size: 16px;
      border-radius: 4px;
      width: 100%;
    }

    #other_input {
      width: 100%;
      padding: 8px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    /* Workshop dates styling */
    .workshop-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
    }

    .workshop-label {
      font-size: 14px;
      margin-right: 10px;
    }

    .workshop-checkbox {
      margin-left: 10px;
    }

    /* Add more space below the heading */
    h2.lede {
      margin-bottom: 30px;
    }</style></head><body class="page-home"><div id="skiptocontent"><a href="#main">skip to main content</a></div><div class="contact-bar"><div><a href="tel:07971286442">07971 286442</a></div><div><a href="mailto:dani@danileearts.co.uk">dani@danileearts.co.uk</a></div></div><header class="header"><a href="./" class="hgroup"><picture><source type="image/avif" srcset="img/dani-lee.avif"><img src="img/dani-lee.png" width="394" height="89" alt="Dani Lee Arts"></picture></a><ul class="mainnav nav"><li><a href="./">Home</a></li><li><a href="portfolio.html">Portfolio</a></li><li><a href="about.html">About</a></li><li><a href="news.html">News</a></li><li class="active"><a href="booking_form.html">Booking</a></li></ul></header><main class="main" id="main"><h2 class="lede">Book your place on the Mosaic Workshops for the Amman Valley Community Mural</h2><form id="booking-form" class="booking-form"><div><label for="email">Email:</label> <input type="email" id="email" name="email" required></div><div><label for="first_name">First Name:</label> <input type="text" id="first_name" name="first_name" required></div><div><label for="last_name">Last Name:</label> <input type="text" id="last_name" name="last_name" required></div><div><label for="postcode">Postcode:</label> <input type="text" id="postcode" name="postcode" required></div><div><label for="telephone">Telephone:</label> <input type="text" id="telephone" name="telephone" required></div><div><label for="age">Age Range:</label> <select id="age" name="age" required><option value="" disabled="disabled" selected="selected">Select your age range</option><option value="13-15">13-15</option><option value="16-20">16-20</option><option value="21-30">21-30</option><option value="31-40">31-40</option><option value="41-50">41-50</option><option value="51-60">51-60</option><option value="61-70">61-70</option><option value="70+">70+</option></select></div><div><label for="organisation">Are you from an organisation? If yes, please specify:</label> <input type="text" id="organisation" name="organisation"></div><div><label for="date">Select Workshop Dates:</label><div id="workshop-dates-container"></div><!-- Container for workshop dates --></div><div><label for="project_marketing">How did you hear about the project?</label> <select id="project_marketing" name="project_marketing" required><option value="" disabled="disabled" selected="selected">Select an option</option><option value="poster or leaflet">Poster or leaflet</option><option value="online">Online</option><option value="through shadows">Through Shadows</option><option value="from a friend">From a friend</option><option value="presentation by Dani">Presentation by Dani at your group</option><option value="other">Other</option></select><!-- "Other" input field in its own div for visibility --><div id="other_input_container" style="display:none;"><input type="text" id="other_input" name="other_input" placeholder="Please specify"></div></div><button type="submit" class="button">Book Now</button></form><div id="booking-result"></div></main><footer class="footer"><div class="footer-nav-wrap"><ul class="footer-nav nav"><li><a href="./">Home</a></li><li><a href="portfolio.html">Portfolio</a></li><li><a href="about.html">About</a></li><li><a href="news.html">News</a></li><li class="active"><a href="booking_form.html">Booking</a></li></ul><div class="footer-links"><div><a href="tel:07971286442">07971 286442</a></div><div><a href="mailto:dani@danileearts.co.uk">dani@danileearts.co.uk</a></div></div></div><div class="copy">&copy;2020 Dani Lee Arts, Wernlas, Cwmdu, Llandeilo, Carmarthenshire, SA19 7EE.</div><div class="credit"><a href="https://pontbren.com">Website by Pontbren</a></div></footer><script>async function fetchWorkshopDates() {
      const apiUrl = 'https://unifiedintegrations.azurewebsites.net/api/DaniLee/workshop-availability';

      try {
        const response = await fetch(apiUrl, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        const workshops = await response.json();

        const container = document.getElementById('workshop-dates-container');
        container.innerHTML = ''; // Clear existing options

        // Populate the workshops dynamically
        workshops.forEach(workshop => {
          const div = document.createElement('div');
          div.classList.add('workshop-item');
          div.innerHTML = `
            <span class="workshop-label">${workshop.projectName} - ${workshop.date} - ${workshop.artForm}</span>
            <input type="checkbox" class="workshop-checkbox" name="date" value="${workshop.date}">
          `;
          container.appendChild(div);
        });
      } catch (error) {
        console.error('Error fetching workshop dates:', error);
      }
    }

    document.getElementById('booking-form').addEventListener('submit', async function (event) {
    event.preventDefault(); // Prevent the default form submission

    const formData = {
        email: document.getElementById('email').value,
        firstName: document.getElementById('first_name').value,
        lastName: document.getElementById('last_name').value,
        postcode: document.getElementById('postcode').value,
        telephone: document.getElementById('telephone').value,
        age: document.getElementById('age').value,
        organisation: document.getElementById('organisation').value || 'N/A',
        marketingSource: document.getElementById('project_marketing').value,
        otherInput: document.getElementById('other_input').value || 'N/A'
    };

    // Get selected workshop dates
    const selectedDates = Array.from(document.querySelectorAll('input[name="date"]:checked'))
        .map(input => input.value);

    if (selectedDates.length === 0) {
        alert('Please select at least one workshop date.');
        return;
    }

    try {
        // Loop through selected workshop dates and handle Google Sheets & Email API calls
        for (const date of selectedDates) {
            formData.date = date;  // Set the current date

            const dataToWrite = [
                [
                    formData.email,
                    formData.firstName,
                    formData.lastName,
                    formData.postcode,
                    formData.telephone,
                    formData.age,
                    formData.organisation,
                    formData.date,
                    formData.marketingSource
                ]
            ];

            // Send the data to Google Sheets
            const response = await fetch('https://unifiedintegrations.azurewebsites.net/api/GoogleSheets/write?spreadsheetId=1oO34X0XFRBd-cdb6LoplIvmdfLoTcBFW-ijs2UQtE_g&clientName=DaniLee', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dataToWrite)
            });

            if (!response.ok) {
                throw new Error(`Error submitting to Google Sheets for ${formData.date}`);
            }

            // Send the booking confirmation email
            const emailResponse = await fetch(`https://unifiedintegrations.azurewebsites.net/api/DaniLee/send-booking-confirmation?recipientEmail=${encodeURIComponent(formData.email)}&firstName=${encodeURIComponent(formData.firstName)}&workshopDate=${encodeURIComponent(formData.date)}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            if (!emailResponse.ok) {
                throw new Error(`Failed to send confirmation for ${formData.date}`);
            }
        }

        // Once all dates have been processed, redirect to booking.html
        document.getElementById('booking-result').innerText = 'Booking successful! Thank you.';
        window.location.href = 'booking.html';  // Only redirect after everything is complete

          } catch (error) {
              console.error('Error submitting the form:', error);
              document.getElementById('booking-result').innerText = `Booking failed. Please try again.`;
          }
      });

    document.addEventListener('DOMContentLoaded', function () {
      // Fetch and populate the workshop dates when the page loads
      fetchWorkshopDates();
    });</script></body></html>